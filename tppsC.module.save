<?php

function tppsC_menu() {
  $items = array();
  
  $items['admin/config/content/tppsC'] = array(
    'title' => 'tppsC',
    'description' => 'Configuration for the tppsC module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('tppsC_form'),
    'access arguments' => array('access administration pages'),
    'type' => MENU_CALLBACK,
  );

  $items['tppsC'] = array (
    'title' => 'Internal TPPS Pipeline',
    'description' => 'FORM TEST 1',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('tppsC_form'),
    'access callback' => TRUE
  );
  
  return $items;
}

function tppsC_form($form, &$form_state) { 

  $form['DOI'] = array(
    '#type' => 'textfield',
    '#title' => t('DOI:'),
    '#size' => 40,
    '#maxlength' => 100,
    '#required' => TRUE,
  );

  $form['species'] = array(
    '#type' => 'textfield',
    '#title' =>t('Species:'),
    '#size' => 40,
    '#maxlength' => 100,
    '#required' => TRUE,
    '#description' => t('For multiple species, seperate each with a comma'),
  );

  $study_type_options = array(
    'G' => 'Genotype',
    'P' => 'Phenotype',
    'E' => 'Environment',
    'GxP' => 'Genotype x Phenotype',
    'GxE' => 'Genotype x Environment',
    'PxE' => 'Phenotype x Environment',
    'GxPxE' => 'Genotype x Phenotype x Environment',
  );

  $form['study_type'] = array(
    '#type' => 'select',
    '#title' => t('Study Type:'),
    '#options' => $study_type_options,
    '#required' => TRUE,
  );

  $genotype_marker_type = array(
    'SNPS' => 'SNPs',
    'SSRs/cpSSRs' => 'SSRs/cpSSRs',
    'Other' => 'Other',
  );

  $form['genotype_marker_SNPS'] = array(
    '#type' => 'radio',
    '#title' => 'SNPs'


  $form['genotype_marker_type'] = array(
    '#type' => 'checkboxes',
    '#title' => t('Genotype Marker Type:'),
    '#options' => $genotype_marker_type,
    '#states' => array(
      'visible' => array(
        array(
          array('select[name="study_type"]' => array('value' => 'G')),
          'or',
          array('select[name="study_type"]' => array('value' => 'GxE')),
          'or',
          array('select[name="study_type"]' => array('value' => 'GxP')),
          'or',
          array('select[name="study_type"]' => array('value' => 'GxPxE')),
        )
      ),
    ),
  );

  $form['genotype_file_upload'] = array(
    '#type' => 'file',
    '#title' => t('Genotype File Upload'),
    '#description' => t('Upload a file, allowed extensions are .xls and .vcf'),
    '#states' => array(
      'visible' => array(
        array(
          array('select[name="study_type"]' => array('value' => 'G')),
          'or',
          array('select[name="study_type"]' => array('value' => 'GxP')),
          'or',
          array('select[name="study_type"]' => array('value' => 'GxE')),
          'or',
          array('select[name="study_type"]' => array('value' => 'GxPxE')),
        )
      ),
    ),
  );


  $study_design_options = array(
    'Natural Population' => 'Natural Population',
    'Growth Chamber' => 'Growth Chamber',
    'Greenhouse' => 'Greenhouse',
    'Common Garden' => 'Common Garden',
    'Plantation' => 'Plantation',
  );

  $form['study_design'] = array(
    '#type' => 'select',
    '#title' => t('Study Design:'),
    '#options' => $study_design_options,
    '#required' => TRUE,
  );

  $study_location_options = array(
    'WGS 84' => 'Latitude/Longitude (WGS 84)',
    'NAD 83' => 'Latitude/Longitude (NAD 83)',
    'ETRS 89' => 'Latitude/Longitude (ETRS 89)',
    'Custom Location' => 'Custom Location',
  );

  $form['study_location'] = array(
    '#type' => 'select',
    '#title' => t('Study Location:'),
    '#options' => $study_location_options,
    '#required' => TRUE,
  );

  $form['study_location_states_exact'] = array(
    '#type' => 'textfield',
    '#title' => t('Coordinates:'),
    '#states' => array(
      'visible' => array(
        array(
          array('select[name="study_location"]' => array('value' => 'WGS 84')),
          'or',
          array('select[name="study_location"]' => array('value' => 'NAD 83')),
          'or',
          array('select[name="study_location"]' => array('value' => 'ETRS 89')),
        )
      ),
    ),
    '#description' => t('Accepted Formats are Degrees Minutes Seconds, Degrees Decimal Minutes, and Decimal Degrees.'),
  );

  $form['study_location_states_custom'] = array(
    '#type' => 'textfield',
    '#title' => t('Custom Location:'),
    '#states' => array(
      'visible' => array(
        'select[name="study_location"]' => array('value' => 'Custom Location'),
      ),
    ),
  );

  $form['submit_button'] = array('#type' => 'submit', '#value' => t('Submit'));

  return $form;

}

function tppsC_form_validate($form, &$form_state) {
}

function tppsC_form_submit($form, &$form_state) {
  $DOI = $form_state['values']['DOI'];
  $species = $form_state['values']['species'];
  $studyType = $form_state['values']['study_type'];
  $studyDesign = $form_state['values']['study_design'];
  $studyLocation = $form_state['values']['study_location'];
  
  if ($studyLocation == 'WGS 84' or $studyLocation = 'NAD 83' or $studyLocation = 'ETRS 89') {
    $studyLocationCoord = $form_state['values']['study_location_states_exact'];
  }
  elseif ($studyLocation == 'Custom Location') {
    $studyLocationCoord = $form_state['values']['study_location_states_custom'];
  }

  drupal_set_message(t('Results Below'));
  drupal_set_message($DOI);
  drupal_set_message($species);
  drupal_set_message($studyType);
  drupal_set_message($studyDesign);
  drupal_set_message($studyLocation);
  drupal_set_message($studyLocationCoord);
}

function tppsC_permission() {
  return array(
    'access tppsC content' => array(
      'title' => t('Access content for the tppsC module'),
     )
  );

}

function tppsC_help($path, $arg) {
  switch ($path) {
    case "admin/help#tppsC":
      return t("my custom internal tppsC module");
      break;
  }

}

