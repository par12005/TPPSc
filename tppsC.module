<?php

function tppsC_menu() {
  $items = array();

  $items['admin/config/content/tppsC'] = array(
    'title' => 'tppsC',
    'description' => 'Configuration for the tppsC module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('tppsC_form'),
    'access arguments' => array('access administration pages'),
    'type' => MENU_CALLBACK,
  );

  $items['tppsC'] = array (
    'title' => 'Internal tppsC Pipeline',
    'description' => 'aka lets get tppsC',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('tppsC_form'),
    'access callback' => TRUE
  );

  return $items;
}

function tppsC_form($form, &$form_state) { 

    
    function DOI(&$form, $form_state){
        $form['DOI'] = array(
            '#type' => 'textfield',
            '#title' => t('DOI:'),
            '#maxlength' => 100,
            '#required' => TRUE,
        );
        return $form;
    }
  
    DOI($form, $form_state);
  
    function species(&$form, $form_state){
        $species_dropdown_option = array(
          '1' => '1', '2' => '2', '3' => '3', '4' => '4', '5' => '5', '6' => '6', '7' => '7', '8' => '8', '9' => '9', '10' => '10', '11' => '11', '12' => '12', '13' => '13', '14' => '14', '15' => '15', '16' => '16', '17' => '17', '18' => '18', '19' => '19', '20' => '20',
        );

        $form['species_dropdown'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'select',
            '#title' => t('How many species are there in the study?'),
            '#options' => $species_dropdown_option,
            '#required' => TRUE,
            '#suffix' => '</div>',
        );

        $form['species1'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 1:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '1')), array('select[name="species_dropdown"]' => array('value' => '2')), array('select[name="species_dropdown"]' => array('value' => '3')), array('select[name="species_dropdown"]' => array('value' => '4')), array('select[name="species_dropdown"]' => array('value' => '5')), array('select[name="species_dropdown"]' => array('value' => '6')), array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species2'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 2:'),
            '#states' => array(
                'visible' => array(
                    array(
                        array('select[name="species_dropdown"]' => array('value' => '2')), array('select[name="species_dropdown"]' => array('value' => '3')), array('select[name="species_dropdown"]' => array('value' => '4')), array('select[name="species_dropdown"]' => array('value' => '5')), array('select[name="species_dropdown"]' => array('value' => '6')), array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                    ),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species3'] = array(
              '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 3:'),
            '#states' => array(
                'visible' => array(
                array(
                    array('select[name="species_dropdown"]' => array('value' => '3')), array('select[name="species_dropdown"]' => array('value' => '4')), array('select[name="species_dropdown"]' => array('value' => '5')), array('select[name="species_dropdown"]' => array('value' => '6')), array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                    ),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species4'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 4:'),
            '#states' => array(
                'visible' => array(
                array(
                    array('select[name="species_dropdown"]' => array('value' => '4')), array('select[name="species_dropdown"]' => array('value' => '5')), array('select[name="species_dropdown"]' => array('value' => '6')), array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                    ),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species5'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 5:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '5')), array('select[name="species_dropdown"]' => array('value' => '6')), array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                    ),
                ),
            '#suffix' => '</div>',
        );

        $form['species6'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 6:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '6')), array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species7'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 7:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '7')), array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20'))
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species8'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 8:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '8')), array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species9'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 9:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '9')), array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species10'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 10:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '10')), array('select[name="species_dropdown"]' => array('value' => '11')), array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species11'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 11:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '11')),array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species12'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 12:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '12')), array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                    ),
            ),
            '#suffix' => '</div>',
        );

        $form['species13'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 13:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '13')), array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species14'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 14:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '14')), array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species15'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 15:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '15')), array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species16'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 16:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '16')), array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species17'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 17:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '17')), array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species18'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 18:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '18')), array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species19'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 19:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '19')), array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );

        $form['species20'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'textfield',
            '#title' => t('Species 20:'),
            '#states' => array(
                'visible' => array(
                    array('select[name="species_dropdown"]' => array('value' => '20')),
                ),
            ),
            '#suffix' => '</div>',
        );
        
        return $form;
  }
  
    species($form, $form_state);
  
    function study_type(&$form, $form_state){
  
        $study_type_options = array(
            'G' => 'Genotype',
            'P' => 'Phenotype',
            'E' => 'Environment',
            'GxP' => 'Genotype x Phenotype',
            'GxE' => 'Genotype x Environment',
            'PxE' => 'Phenotype x Environment',
            'GxPxE' => 'Genotype x Phenotype x Environment',
        );
        $form['study_type'] = array(
            '#type' => 'select',
            '#title' => t('Study Type:'),
            '#options' => $study_type_options,
            '#required' => TRUE,
        );
        return $form;
    }
    
    study_type($form, $form_state);
    
    function genotype(&$form, $form_state){
        $genotype_marker_types = array(
            'SNPs' => 'SNPs',
            'SSRs/cpSSRs' => 'SSRs/cpSSRs',
        'Other' => 'Other',
        );

        $form['genotype_marker_type'] = array(
            '#type' => 'checkboxes',
            '#title' => t('Genotype Marker Type:'),
            '#options' => $genotype_marker_types,
            '#states' => array(
                'visible' => array(
                    array(
                        array('select[name="study_type"]' => array('value' => 'G')), array('select[name="study_type"]' => array('value' => 'GxE')), array('select[name="study_type"]' => array('value' => 'GxP')), array('select[name="study_type"]' => array('value' => 'GxPxE')),
                        )
                    )
            ),
        );

        $genotype_SNPs_design_options = array(
            '-Select-' => '-Select-',
            'GBS' => 'GBS',
            'Targeted Capture' => 'Targeted Capture',
            'Whole Genome Resequencing' => 'Whole Genome Resequencing',
            'RNA-Seq' => 'RNA-Seq',
            'Genotyping Array' => 'Genotyping Array',
        );
        
        $form['genotype_SNPs_design'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'select',
            '#title' => t('Genotyping Design:'),
            '#options' => $genotype_SNPs_design_options,
            '#states' => array(
                'visible' => array(
                    ':input[name="genotype_marker_type[SNPs]"]' => array('checked' => TRUE),
                ),
            ),
            '#suffix' => '</div>',
        );
        
        $genotype_GBS_options = array(
            '-Select-' => '-Select-',
            'RAD-Seq' => 'RAD-Seq',
            'ddRAD-Seq' => 'ddRAD-Seq',
            'NextRAD' => 'NextRAD',
            'RAPTURE' => 'RAPTURE',
            'Other' => 'Other',
        );
        
        $form['genotype_GBS'] = array(
            '#prefix' => '<div class="container-inline">',
            '#suffix' => '</div>',
            '#type' => 'select',
            '#title' => t('GBS Type:'),
            '#options' => $genotype_GBS_options,
            '#states' => array(
                'visible' => array(
                    'select[name="genotype_SNPs_design"]' => array('value' => 'GBS')
                ),
            ),
        );
        
        $form['genotype_GBS_other'] = array(
            '#prefix' => '<div class="container-inline">',
            '#suffix' => '</div>',
            '#type' => 'textfield',
            '#title' => t('Other GBS Type:'),
            '#states' => array(
                'visible' => array(
                    'select[name="genotype_GBS"]' => array('value' => 'Other'),
                ),
            ),
        );
        
        $genotype_targeted_capture_options = array(
            '-Select-' => '-Select-',
            'Exome Capture' => 'Exome Capture',
            'Other' => 'Other',
        );
        
        $form['genotype_targeted_capture'] = array(
            '#prefix' => '<div class="container-inline">',
            '#suffix' => '</div>',
            '#type' => 'select',
            '#title' => t('Targeted Capture Type:'),
            '#options' => $genotype_targeted_capture_options,
            '#states' => array(
                'visible' => array(
                    'select[name="genotype_SNPs_design"]' => array('value' => 'Targeted Capture'),
                ),
            ),
        );
        
        $form['targeted_capture_other'] = array(
            '#prefix' => '<div class="container-inline">',
            '#suffix' => '</div>',
            '#type' => 'textfield',
            '#title' => t('Other TC Type:'),
            '#states' => array(
                'visible' => array(
                    'select[name="genotype_targeted_capture"]' => array('value' => 'Other'),
                ),
            ),
        );
        
        $form['genotype_SNPs'] = array(
            '#type' => 'managed_file',
            '#title' => t('SNPs File Upload'),
            '#description' => t('Please upload a .vcf file with the SNPs information.'),
            '#upload_validators' => array('file_validate_extensions' => array('vcf')),
            '#states' => array(
                'visible' => array(
                    ':input[name="genotype_marker_type[SNPs]"]' => array('checked' => TRUE),
                ),
            ),
        );
        
        $form['genotype_SSRs'] = array(
            '#type' => 'managed_file',
            '#title' => t('SSRs/cpSSRs File Upload'),
            '#upload_validators' => array('file_validate_extensions' => array('txt csv xlsx')),
            '#tree' => TRUE,
            '#states' => array(
                'visible' => array(
                    array(':input[name="genotype_marker_type[SSRs/cpSSRs]"]' => array('checked' => TRUE)),
                    array(':input[name="genotype_marker_type[Other]"]' => array('checked' => TRUE)),
                ),
            ),
        );
        $form['genotype_SSRs']['file']['columns'] = array(
            '#type' => 'fieldset',
            '#title' => t('Define Data'),
            '#description' => t('Please define which columns hold the required data:'),
            '#states' => array(
                'invisible' => array(
                    ':input[name="genotype_SSRs_upload_button"]' => array('value' => 'Upload'))),
        );
        $file = 0;
        if (isset($form_state['values']['genotype_SSRs']) and $form_state['values']['genotype_SSRs'] != 0){
            $file = $form_state['values']['genotype_SSRs'];
        }
        if ($file != 0){
            if (($file = file_load($file))){
            $file_name = $file->uri;
            $location = drupal_realpath("$file_name");
            $content = parse_xlsx($location);
            $column_options = array(
                'N/A',
                'Tree Identifier',
                'Genotypic Information',
            );
                $first = TRUE;
                foreach ($content['headers'] as $item){
                    $form['genotype_SSRs']['file']['columns'][$item] = array(
                        '#type' => 'select',
                        '#title' => t($item),
                        '#options' => $column_options,
                        '#prefix' => "<td>",
                        '#suffix' => "</td>",
                        '#attributes' => array(
                            'data-toggle' => array('tooltip'),
                            'data-placement' => array('left'),
                            'title' => array("Select the type of data the '$item' column holds")
                        )
                    );  
                    if ($first){
                        $first = FALSE;
                        $form['genotype_SSRs']['file']['columns'][$item]['#prefix'] = "<div style='overflow-x:auto'><table border='1'><tbody><tr>" . $form['genotype_SSRs']['file']['columns'][$item]['#prefix'];
                    }
                }
            }
            $display = "</tr>";
            for ($i = 0; $i < 3; $i++){
                if (isset($content[$i])){
                    $display .= "<tr>";
                    foreach ($content['headers'] as $item){
                        $display .= "<th>{$content[$i][$item]}</th>";
                    }
                    $display .= "</tr>";
                }
            }
            $display .= "</tbody></table></div>";

            $form['genotype_SSRs']['file']['columns'][$item]['#suffix'] .= $display;
            }
            
        
        $ref_genome = array(
            '1' => '-Select-', 
            'URL' => 'I can provide a URL to my Reference Genome or assembly file(s)' , 
            'BIO' => 'I can provide a BioProject accession number', 
            'OWN' => 'I can upload my own assembly file',
            'Juglans nigra v1.0' => 'Juglans nigra v1.0', 'Fraxinus excelsior v0.5' => 'Fraxinus excelsior v0.5', 'Fraxinus excelsior v0.1' => 'Fraxinus excelsior v0.1', 'Fraxinus excelsior v0.4' => 'Fraxinus excelsior v0.4', 'Populus trichocarpa v2.0' => 'Populus trichocarpa v2.0', 'Populus trichocarpa v3.0' => 'Populus trichocarpa v3.0', 'Manihot esculenta v6.1' => 'Manihot esculenta v6.1', 'Picea glauca v1.0' => 'Picea glauca v1.0', 'Quercus robur v1.0' => 'Quercus robur v1.0', 'Hevea brasiliensis v1.0' => 'Hevea brasiliensis v1.0', 'Populus deltoides v2.1' => 'Populus deltoides v2.1', 'Pinus taeda v1.01' => 'Pinus taeda v1.01', 'Pinus taeda v1.0' => 'Pinus taeda v1.0', 'Pinus taeda v2.01' => 'Pinus taeda v2.01', 'Populus tremuloides v1.0' => 'Populus tremuloides v1.0','Ginkgo biloba v1.0' => 'Ginkgo biloba v1.0', 'Juglans regia v1.0' => 'Juglans regia v1.0', 'Carica papaya v0.4' => 'Carica papaya v0.4', 'Olea europaea v1.0' => 'Olea europaea v1.0', 'Eucalyptus camaldulensis v1.0' => 'Eucalyptus camaldulensis v1.0', 'Juglans cathayensis v1.0' => 'Juglans cathayensis v1.0', 'Handroanthus impetiginosus v1.0' => 'Handroanthus impetiginosus v1.0', 'Vitis vinifera v145' => 'Vitis vinifera v145', 'Pterocarya stenoptera v1.0' => 'Pterocarya stenoptera v1.0', 'Elaeis guineensis v1.0' => 'Elaeis guineensis v1.0', 'Aquilaria agallocha v1.0' => 'Aquilaria agallocha v1.0', 'Symphonia globulifera v1.0' => 'Symphonia globulifera v1.0', 'Gnetum montanum v1.0' => 'Gnetum montanum v1.0', 'Quercus lobata v1.0' => 'Quercus lobata v1.0', 'Populas tremula x Populus tremuloides v1.0' => 'Populas tremula x Populus tremuloides v1.0','Pinus lambertiana v1.5' => 'Pinus lambertiana v1.5', 'Pinus lambertiana v0.5' => 'Pinus lambertiana v0.5', 'Pinus lambertiana v1.0' => 'Pinus lambertiana v1.0', 'Juglans sigillata v1.0' => 'Juglans sigillata v1.0', 'Populus euphratica v1.0' => 'Populus euphratica v1.0', 'Betula nana v1.0' => 'Betula nana v1.0', 'Picea abies v1.0b' => 'Picea abies v1.0b', 'Populus pruinosa v1.0' => 'Populus pruinosa v1.0', 'Eucalyptus grandis v1.0' => 'Eucalyptus grandis v1.0', 'Jatropha curcas v4.5' => 'Jatropha curcas v4.5', 'Phoenis dactylifera v1.0' => 'Phoenis dactylifera v1.0', 'Populus tremula v1.0' => 'Populus tremula v1.0', 'Abies alba v1.0' => 'Abies alba v1.0', 'Pseudotsuga menziesii v0.5' => 'Pseudotsuga menziesii v0.5', 'Pseudotsuga menziesii v1.0' => 'Pseudotsuga menziesii v1.0',
        );

        $form['genotype_reference_genome'] = array(
            '#prefix' => '<div class="container-inline">',
            '#type' => 'select',
            '#title' => t('Reference Genome Used: '),
            '#options' => $ref_genome,
            '#states' => array(
                'visible' => array(
                        array('select[name="study_type"]' => array('value' => 'G')), array('select[name="study_type"]' => array('value' => 'GxE')), array('select[name="study_type"]' => array('value' => 'GxP')), array('select[name="study_type"]' => array('value' => 'GxPxE')), 
                    )
                ),
            '#suffix' => '</div>',
        );            
  
        $form['genotype_reference_genome_url'] = array(
            '#type' => 'textfield',
            '#title' => t('URL to Reference Genome:'),
            '#states' => array(
                'visible' => array('select[name="genotype_reference_genome"]' => array('value' => 'URL'))
            ),
        );
        
        $form['genotype_reference_genome_bio'] = array(
            '#type' => 'textfield',
            '#title' => t('BioProject Accession Number:'),
            '#states' => array(
                'visible' => array('select[name="genotype_reference_genome"]' => array('value' => 'BIO'))
            ),
        );
        
        $form['genotype_reference_genome_upload'] = array(
            '#type' => 'managed_file',
            '#title' => t('Assembly File: please provide an assembly file in FASTA or Multi-FASTA format:'),
            '#upload_validators' => array('file_validate_extensions' => array('fsa_nt')),
            '#states' => array(
                'visible' => array('select[name="genotype_reference_genome"]' => array('value' => 'OWN'))
            ),
        );
        
        return $form;
    }
    
    genotype($form, $form_state);
    
    function phenotype(&$form, $form_state){
        
        $form['phenotype_file'] = array(
            '#type' => 'managed_file',
            '#title' => t('Phenotype File Upload'),
            '#tree' => TRUE,
            '#upload_validators' => array('file_validate_extensions' => array('txt csv xlsx')),
            '#states' => array(
                'visible' => array(
                    array(
                        array('select[name="study_type"]' => array('value' => 'P')), array('select[name="study_type"]' => array('value' => 'PxE')), array('select[name="study_type"]' => array('value' => 'GxP')), array('select[name="study_type"]' => array('value' => 'GxPxE')),
                    )
                ),
            ),
        );
        
        $form['phenotype_file']['file']['columns'] = array(
            '#type' => 'fieldset',
            '#title' => t('Define Data'),
            '#description' => t('Please define which columns hold the required data:'),
            '#states' => array(
                'invisible' => array(
                    ':input[name="phenotype_file_upload_button"]' => array('value' => 'Upload'))),
        );
        $file = 0;
        if (isset($form_state['values']['phenotype_file']) and $form_state['values']['phenotype_file'] != 0){
            $file = $form_state['values']['phenotype_file'];
        }
        if ($file != 0){
            if (($file = file_load($file))){
                $file_name = $file->uri;
                $location = drupal_realpath("$file_name");
                $content = parse_xlsx($location);
                $column_options = array(
                    'N/A',
                    'Tree Identifier',
                    'Phenotype Name/Identifier',
                    'Value(s)',
                );
                $first = TRUE;
                foreach ($content['headers'] as $item){
                    $form['phenotype_file']['file']['columns'][$item] = array(
                        '#type' => 'select',
                        '#title' => t($item),
                        '#options' => $column_options,
                        '#prefix' => "<td>",
                        '#suffix' => "</td>",
                        '#attributes' => array(
                            'data-toggle' => array('tooltip'),
                            'data-placement' => array('left'),
                            'title' => array("Select the type of data the '$item' column holds")
                        )
                    );
                    if ($first){
                        $first = FALSE;
                        $form['phenotype_file']['file']['columns'][$item]['#prefix'] = "<div style='overflow-x:auto'><table border='1'><tbody><tr>" . $form['phenotype_file']['file']['columns'][$item]['#prefix'];
                    }
                }
            }
            $display = "</tr>";
            for ($i = 0; $i < 3; $i++){
                if (isset($content[$i])){
                    $display .= "<tr>";
                    foreach ($content['headers'] as $item){
                        $display .= "<th>{$content[$i][$item]}</th>";
                    }
                    $display .= "</tr>";
                }
            }
            $display .= "</tbody></table></div>";

            $form['phenotype_file']['file']['columns'][$item]['#suffix'] .= $display;
        }
        
        return $form;
    }
    
    phenotype($form, $form_state);

    
    function environment(&$form, $form_state){

        $form['environment_file_upload'] = array(
            '#type' => 'managed_file',
            '#title' => t('Environment File Upload'),
            '#description' => t('Optional: Upload an excel file of enviornmental data.'),
            '#upload_validators' => array('file_validate_extensions' => array('txt csv xlsx')),
            '#states' => array(
                'visible' => array(
                    array(
                        array('select[name="study_type"]' => array('value' => 'E')), array('select[name="study_type"]' => array('value' => 'PxE')), array('select[name="study_type"]' => array('value' => 'GxE')), array('select[name="study_type"]' => array('value' => 'GxPxE')),
                    )
                ),
            ),
        );

        return $form;
    }
    
    environment($form, $form_state);

    function otherStudy(&$form, $form_state){
        
        $study_design_options = array(
            'Natural Population' => 'Natural Population',
            'Growth Chamber' => 'Growth Chamber',
            'Greenhouse' => 'Greenhouse',
            'Common Garden' => 'Common Garden',
            'Plantation' => 'Plantation',
        );

        $form['study_design'] = array(
            '#type' => 'select',
            '#title' => t('Study Design:'),
            '#options' => $study_design_options,
            '#required' => TRUE,
        );

        $study_location_options = array(
            'WGS 84' => 'Latitude/Longitude (WGS 84)',
            'NAD 83' => 'Latitude/Longitude (NAD 83)',
            'ETRS 89' => 'Latitude/Longitude (ETRS 89)',
            'Custom Location' => 'Custom Location',
        );

        $form['study_location'] = array(
            '#type' => 'select',
            '#title' => t('Study Location:'),
            '#options' => $study_location_options,
            '#required' => TRUE,
        );

        $form['study_location_states_exact'] = array(
            '#type' => 'textfield',
            '#title' => t('Coordinates:'),
            '#states' => array(
                'visible' => array(
                    array(
                        array('select[name="study_location"]' => array('value' => 'WGS 84')), array('select[name="study_location"]' => array('value' => 'NAD 83')), array('select[name="study_location"]' => array('value' => 'ETRS 89')),
                    )
                ),
            ),
            '#description' => t('Accepted Formats are Degrees Minutes Seconds, Degrees Decimal Minutes, and Decimal Degrees.'),
        );

        $form['study_location_states_custom'] = array(
            '#type' => 'textfield',
            '#title' => t('Custom Location:'),
            '#description' => t('Ex: Street Address, or other location formats.'),
            '#states' => array(
                'visible' => array(
                    'select[name="study_location"]' => array('value' => 'Custom Location'),
                ),
            ),
        );
        
        return $form;
    }
    
    otherStudy($form, $form_state);
        
    
    function tree_location(&$form, $form_state){
        
        $form['tree_location'] = array(
            '#type' => 'managed_file',
            '#title' => t('Tree Accession File'),
            '#upload_validators' => array('file_validate_extensions' => array('txt csv xlsx')),
            '#tree' => TRUE,
            '#description' => t('Please provide a spreadsheet with columns for the Tree ID and the location of trees used in this study'),
        );

        $form['tree_location']['file']['columns'] = array(
            '#type' => 'fieldset',
            '#title' => t('Define Data'),
            '#description' => t('Please define which columns hold the required data:'),
            '#states' => array(
                'invisible' => array(
                    ':input[name="tree_location_upload_button"]' => array('value' => 'Upload'))),
        );
        $file = 0;
        if (isset($form_state['values']['tree_location']) and $form_state['values']['tree_location'] != 0){
            $file = $form_state['values']['tree_location'];
        }
        if ($file != 0){
            if (($file = file_load($file))){
                $file_name = $file->uri;
                $location = drupal_realpath("$file_name");
                $content = parse_xlsx($location);
                $column_options = array(
                    'N/A',
                    'Tree Identifier',
                    'Country',
                    'State',
                    'County',
                    'District',
                    'Latitude',
                    'Longitude',
                    'Genus',
                    'Species',
                    'Genus+Species',
                    'Altitude',
                    'Time',
                );
                $first = TRUE;
                foreach ($content['headers'] as $item){
                    $form['tree_location']['file']['columns'][$item] = array(
                        '#type' => 'select',
                        '#title' => t($item),
                        '#options' => $column_options,
                        '#prefix' => "<td>",
                        '#suffix' => "</td>",
                        '#attributes' => array(
                            'data-toggle' => array('tooltip'),
                            'data-placement' => array('left'),
                            'title' => array("Select the type of data the '$item' column holds")
                        )
                    );
                    if ($first){
                        $first = FALSE;
                        $form['tree_location']['file']['columns'][$item]['#prefix'] = "<div style='overflow-x:auto'><table border='1'><tbody><tr>" . $form['tree_location']['file']['columns'][$item]['#prefix'];
                    }
                }
            }   
            $display = "</tr>";
            for ($i = 0; $i < 3; $i++){
                if (isset($content[$i])){
                    $display .= "<tr>";
                    foreach ($content['headers'] as $item){
                        $display .= "<th>{$content[$i][$item]}</th>";
                    }
                    $display .= "</tr>";
                }
            }
            $display .= "</tbody></table></div>";

            $form['tree_location']['file']['columns'][$item]['#suffix'] .= $display;
        }  
        
        return $form;
    }

    tree_location($form, $form_state);
    
    $form['submit_button'] = array('#type' => 'submit', '#value' => t('Submit'));

  return $form;

}

function tppsC_form_validate($form, &$form_state) {
}

function tppsC_form_submit($form, &$form_state) {
    $data = array();
    $DOI = $form_state['values']['DOI'];
    $species_dropdown = $form_state['values']['species_dropdown'];
    $studyType = $form_state['values']['study_type'];
    $genotypeDesign = $form_state['values']['genotype_SNPs_design'];
    $genotypeMarkerType = $form_state['values']['genotype_marker_type'];
    
    if ($genotypeDesign == 'GBS'){
        $genotypeGBStype = $form_state['values']['genotype_GBS'];
        if ($genotypeGBStype == 'Other') {
            $genotypeGBStype = $form_state['values']['genotype_GBS_other'];
        }
    }
    else{
        $genotypeGBStype = array();
    }
    if ($genotypeDesign == 'Targeted Capture'){
        $genotypeTargetedCaptureType = $form_state['values']['genotype_targeted_capture'];
        if ($genotypeTargetedCaptureType == 'Other'){
            $genotypeTargetedCaptureType = $form_state['values']['targeted_capture_other'];
        }
    }
    else{
        $genotypeTargetedCaptureType = array();
    }
    
    $studyDesign = $form_state['values']['study_design'];
    $studyLocation = $form_state['values']['study_location'];
    $refGenome = $form_state['values']['genotype_reference_genome'];
    if ($refGenome == 'URL') {
        $refGenome = $form_state['values']['genotype_reference_genome_url'];
    }
    elseif ($refGenome == 'BIO') {
        $refGenome = $form_state['values']['genotype_reference_genome_bio'];
    }
    
    if ($studyLocation == 'WGS 84' or $studyLocation = 'NAD 83' or $studyLocation = 'ETRS 89') {
        $studyLocationCoord = $form_state['values']['study_location_states_exact'];
    }
    elseif ($studyLocation == 'Custom Location') {
        $studyLocationCoord = $form_state['values']['study_location_states_custom'];
    }

    $species1 = $form_state['values']['species1'];
    $species2 = $form_state['values']['species2'];
    $species3 = $form_state['values']['species3'];
    $species4 = $form_state['values']['species4'];
    $species5 = $form_state['values']['species5'];
    $species6 = $form_state['values']['species6'];
    $species7 = $form_state['values']['species7'];
    $species8 = $form_state['values']['species8'];
    $species9 = $form_state['values']['species9'];
    $species10 = $form_state['values']['species10'];
    $species11 = $form_state['values']['species11'];
    $species12 = $form_state['values']['species12'];
    $species13 = $form_state['values']['species13'];
    $species14 = $form_state['values']['species14'];
    $species15 = $form_state['values']['species15'];
    $species16 = $form_state['values']['species16'];
    $species17 = $form_state['values']['species17'];
    $species18 = $form_state['values']['species18'];
    $species19 = $form_state['values']['species19'];
    $species20 = $form_state['values']['species20'];

    $species = array(
        'Species 1' => $species1, 'Species 2' => $species2, 'Species 3' => $species3, 'Species 4' => $species4, 'Species 5' => $species5,  'Species 6' => $species6, 'Species 7' => $species7, 'Species 8' => $species8, 'Species 9' => $species9, 'Species 10' => $species10,  'Species 11' => $species11, 'Species 12' => $species12, 'Species 13' => $species13, 'Species 14' => $species14, 'Species 15' => $species15, 'Species 16' => $species16, 'Species 17' => $species17, 'Species 18' => $species18, 'Species 19' => $species19, 'Species 20' => $species20,
    );
    

    $data = array(
        'DOI' => $DOI,
        'species' => $species,
        'studyType' => $studyType,
        'genotypeDesign' => $genotypeDesign,
        'genotypeMarkerType' => $genotypeMarkerType,
        'genotypeGBStype' => $genotypeGBStype,
        'genotypeTargetedCaptureType' => $genotypeTargetedCaptureType,
        'Reference Genome' => $refGenome,
        'studyDesign' => $studyDesign,
        'studyLocation' => $studyLocation,
        'studyLocationCoord' => $studyLocationCoord,
    );
    dpm($data);
}

function tppsC_permission() {
  return array(
    'access tppsC content' => array(
      'title' => t('Access content for the tppsC module'),
     )
  );

}

function tppsC_help($path, $arg) {
  switch ($path) {
    case "admin/help#tppsC":
      return t("my custom internal tppsC module");
      break;
  }

}

function parse_xlsx($location){

    //modified from https://gist.github.com/searbe/3284011

    $content = array();
    $dir = drupal_realpath("public://tpps_xlsx");

    $zip = new ZipArchive();
    $zip->open($location);
    $zip->extractTo($dir);

    $strings = simplexml_load_file($dir . '/xl/sharedStrings.xml');
    $sheet = simplexml_load_file($dir . '/xl/worksheets/sheet1.xml');

    $xlrows = $sheet->sheetData->row;

    foreach ($xlrows as $xlrow) {
        $arr = array();

        foreach ($xlrow->c as $cell) {

            $v = (string) $cell->v;

            if (isset($cell['t']) && $cell['t'] == 's') {
                $s  = array();
                $si = $strings->si[(int) $v];
                $si->registerXPathNamespace('n', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main');

                foreach($si->xpath('.//n:t') as $t) {
                    $s[] = (string) $t;
                }

                $v = implode($s);
            }
            $arr[] = $v;
        }

        if (!isset($headers)) {
            $headers = $arr;
            $content['headers'] = $headers;
        } 
        else{
            $values = array_pad($arr, count($headers), '');
            $row    = array_combine($headers, $values);
            $content[] = $row;
        }
    }

    @unlink($dir);
    @unlink($inputFile);

    return $content;

}